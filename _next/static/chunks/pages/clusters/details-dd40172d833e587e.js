(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[205],{50068:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/clusters/details",function(){return t(92211)}])},92211:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return k}});var n=t(85893),i=t(39618),l=t(11163),r=t(2504),a=t(21237),d=t(30120),o=t(63029),c=t(48926),u=t(98376),x=t(9324),h=t(71866);let g=[{accessorKey:"address",header:"Address"},{accessorKey:"status",header:"Status",sortable:!0},{accessorKey:"withdrawalAddress",header:"Withdrawal Address"},{accessorKey:"feeRecipient",header:"Fee Recipient"}],v=e=>{let{validators:s,currentAccount:t}=e,l=(0,o.Z)(s.flatMap(e=>[e.withdrawalAddress,e.feeRecipient])),r=e=>{let{address:s,index:t}=e;return(0,n.jsxs)(i.xv,{size:"4",color:"obolGreen",css:{display:"flex",alignItems:"center",justifyContent:"start",gap:"xxxs"},children:[(0,n.jsxs)(i.kC,{direction:"column",css:{mr:"$xxs",fontWeight:"$bold"},children:[l[t]&&(0,n.jsxs)(n.Fragment,{children:[l[t],(0,n.jsx)("br",{})]}),(0,n.jsx)(i.dh,{css:{fontWeight:"bold",color:"$obolGreen",width:"120px !important"},value:(0,a.zN)(s,[0,6],5),readOnly:!0})]}),(0,n.jsx)(c.Z,{address:s})]})},d=e=>{let{address:s,index:t}=e;return l[t]?(0,n.jsxs)(n.Fragment,{children:[l[t],(0,n.jsx)("br",{}),(0,n.jsxs)(i.xu,{css:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)(i.dh,{value:s,readOnly:!0,css:{mr:"$xxs",color:"$obolGreen",width:"120px !important"}}),(0,n.jsx)(c.Z,{address:s})]})]}):(0,n.jsxs)(i.xu,{css:{display:"flex",alignItems:"center",justifyContent:"start"},children:[(0,n.jsx)(i.dh,{value:(0,a.zN)(s,[0,6],5),readOnly:!0,css:{mr:"$xxs",color:"$obolGreen",width:"120px !important"}}),(0,n.jsx)(c.Z,{address:s})]})};return(0,n.jsx)(h.g_,{css:{".table-container":{"@sm":{width:"900px"}}},children:(0,n.jsx)(i.Nk,{tabs:[{title:"Validators",tableProps:{columns:g,rows:s.map((e,s)=>({address:(0,n.jsxs)(i.xu,{css:{display:"flex",alignItems:"center",justifyContent:"start"},children:[(0,n.jsx)(i.dh,{value:(0,a.zN)(e.address,[0,6],5),readOnly:!0,css:{mr:"$xxs",color:"$obolGreen",width:"120px !important"}}),(0,n.jsx)(u.j,{link:"".concat(x.q2,"/validator/").concat(e.address)})]}),status:e.status||"Pending",withdrawalAddress:(0,a.qF)(t,e.withdrawalAddress)?(0,n.jsx)(r,{address:e.withdrawalAddress,index:s}):(0,n.jsx)(d,{address:e.withdrawalAddress,index:s}),feeRecipient:(0,a.qF)(t,e.feeRecipient)?(0,n.jsx)(r,{address:e.feeRecipient,index:s+1}):(0,n.jsx)(d,{address:e.feeRecipient,index:s+1})}))}}]})})},p=(0,i.zo)(i.kC,{flexDirection:"column",width:"auto",gap:"$2xl",px:"10%",py:"$5xl","@sm":{px:"10%",pb:"$5xl",pt:"$xl"}});var j=t(67294),m=t(19485);let f=e=>{let{icon:s,heading:t,children:l}=e;return(0,n.jsxs)(i.mh,{children:[(0,n.jsxs)(i.xu,{children:["successfully"===s&&(0,n.jsx)(i.nQ,{}),"loading"===s&&(0,n.jsx)(i.ZG,{})]}),(0,n.jsx)(i.xu,{css:{display:"flex",fd:"column",gap:"$sm"},children:(0,n.jsxs)(i.xu,{css:{display:"flex",fd:"column",gap:"$xs"},children:[(0,n.jsx)(i.xv,{variant:"body",css:{color:"white"},children:t}),l]})})]})},w=e=>{var s,t,l;let{userBalance:a,distributeAndClaimStatus:d,exitClusterStatus:o,feeRecipientAddress:c,splitMetadata:u,handleOnDistributeAndWithdrawUserFunds:g,handleOnExit:v}=e;console.log(a,d,o,c,u);let{account:p}=(0,r.kR)(),j=(null==d?void 0:d.loading)?{variant:"tx"}:{},w=(null==o?void 0:o.loading)?{variant:"tx"}:{},b="string"==typeof(null==d?void 0:d.txHash)?null==d?void 0:d.txHash:null==d?void 0:null===(s=d.txHash)||void 0===s?void 0:s.transactionHash;return(0,n.jsxs)(i.kC,{css:{gap:"$lg","@sm":{flexDirection:"column",gap:"$md",alignItems:"flex-start",justifyContent:"flex-start",gridColumn:"span 2"}},children:[(0,n.jsxs)(i.W2,{css:{gap:"$lg",alignItems:"flex-start",justifyContent:"flex-start",gridColumn:"span 1"},children:[(0,n.jsx)(i.kC,{css:{justifyContent:"space-between",alignItems:"center"},children:(0,n.jsx)(i.xv,{variant:"h4",children:"Exit Cluster"})}),(null==o?void 0:o.completed)?(0,n.jsx)(f,{icon:"successfully",heading:"Cluster successfully exited"}):(0,n.jsx)(n.Fragment,{children:(null==o?void 0:o.loading)?(0,n.jsxs)(f,{icon:"loading",heading:"Cluster is exiting",children:[(0,n.jsxs)(i.rU,{css:{fontSize:"$4",fontWeight:"$normal"},target:"_blank",href:"beaconchainlink",children:["Check status on Beaconcha.in",(0,n.jsx)(i._j,{size:"sm"})]}),(0,n.jsxs)(i.rU,{css:{fontSize:"$4",fontWeight:"$normal"},target:"_blank",href:"learnmore link",children:["Learn More",(0,n.jsx)(i.ZJ,{size:"sm"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.xv,{variant:"body",children:"Exit all validators in this cluster."}),(0,n.jsx)(i.xv,{variant:"body",children:"This cluster will no longer earn rewards."}),(0,n.jsx)(i.xv,{variant:"body",children:"Upon exiting the cluster you will be able to withdraw the original principle & claim all rewards."}),(0,n.jsx)(h.fl,{...w,color:"primary",type:"button",css:{width:"auto"},disabled:!0,onClick:()=>v(),children:(null==o?void 0:o.loading)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.yC,{}),"Transaction in progress"]}):(0,n.jsx)(n.Fragment,{children:"Exit Cluster"})})]})})]}),(0,n.jsxs)(i.W2,{css:{gap:"$lg",alignItems:"flex-start",justifyContent:"flex-start",gridColumn:"span 1"},children:[(0,n.jsx)(i.kC,{direction:"column",children:(0,n.jsx)(i.xv,{variant:"h4",children:"Claim ETH"})}),(0,n.jsxs)(i.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,n.jsx)(i.xv,{css:{textTransform:"uppercase"},variant:"subline",color:"body",children:"Claimable"}),(0,n.jsx)(i.KZ,{content:"Claimable amount tooltip",children:(0,n.jsx)(i.xu,{css:{display:"flex"},children:(0,n.jsx)(i.by,{})})})]}),(0,n.jsxs)(i.kC,{css:{gap:"$xxs",alignItems:"center"},children:[(0,n.jsx)(i.Ee,{src:"/assets/eth-icon.svg",alt:"eth",width:24,height:24}),(0,n.jsx)(i.xv,{css:{textTransform:"uppercase"},variant:"h5",children:a.balance||"0.00"})]}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.fl,{...j,color:"primary",type:"button",css:{width:"auto"},disabled:!(0,m.isAddress)(p)||!!a.error||!a.balance||(null==d?void 0:d.completed)||!(null==u?void 0:null===(t=u.recipients)||void 0===t?void 0:t.some(e=>e.address.toLowerCase()===(null==p?void 0:p.toLowerCase()))),onClick:()=>g(),fullWidth:!0,children:(null==d?void 0:d.loading)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.yC,{}),"Transaction in progress"]}):(0,n.jsx)(n.Fragment,{children:" Claim ETH"})}),(null==d?void 0:d.completed)&&(0,n.jsx)(f,{icon:"successfully",heading:"Successfully claimed ETH",children:(0,n.jsxs)(i.rU,{css:{fontSize:"$4",fontWeight:"$normal"},target:"_blank",href:"https://".concat(x.pn,".etherscan.io/tx/").concat(b),children:["View on Etherscan",(0,n.jsx)(i._j,{size:"sm"})]})}),u&&!(null===(l=u.recipients)||void 0===l?void 0:l.some(e=>e.address.toLowerCase()===(null==p?void 0:p.toLowerCase())))&&(0,n.jsx)(i.xv,{variant:"metadata",color:"test",children:"You are not a recipient of this split and cannot claim"})]})]})]})};var b=t(23500);let y=e=>{var s,t;let{clusterDefinition:l,validators:a,currentAccount:o,clusterStatus:c}=e,{account:u,provider:x,chainId:g}=(0,r.kR)(),[m,f]=(0,j.useState)(),[y,C]=(0,j.useState)(),_=(null==l?void 0:l.fee_recipient_address)||((null==l?void 0:l.validators)?null===(s=null==l?void 0:l.validators[0])||void 0===s?void 0:s.fee_recipient_address:null),k=(null==l?void 0:l.withdrawal_address)||((null==l?void 0:l.validators)?null===(t=null==l?void 0:l.validators[0])||void 0===t?void 0:t.withdrawal_address:null),$=(0,r.ly)(_),S=(0,j.useMemo)(()=>({accounts:null==$?void 0:$.recipientsSorted[0],percentAllocations:null==$?void 0:$.recipientsSorted[1],distributorFee:0,split:_}),[$,_]),A=(0,r.Tm)(u,S,k),E=async()=>{console.log("handleOnWithdrawFunds"),f(e=>({...e,loading:!0})),"0"!==A.owrBalance?(0,b.E4)(u,k,S,x.getSigner(0),b.Ap).then(e=>{console.log("withdraw tx",e),f(s=>({...s,loading:!1,txHash:e,completed:!0}))}).catch(e=>{f(s=>({...s,loading:!1,errorMessage:e.message})),console.log("error",e)}):(console.log("handleOnWithdrawFunds with OWR already distributed"),(0,b.h_)({chainId:g,provider:x,address:u}).then(e=>{console.log("withdraw tx",e),f(s=>({...s,loading:!1,txHash:e,completed:!0}))}).catch(e=>{f(s=>({...s,loading:!1,errorMessage:e.message})),console.log("error",e)}))};return(0,n.jsxs)(p,{children:[(0,n.jsxs)(i.kC,{direction:"column",css:{gap:"$xxs"},children:[(0,n.jsx)(i.xv,{variant:"h3",children:null==l?void 0:l.name}),(0,n.jsx)(i.xv,{variant:"metadata",color:"body",children:"Created ".concat(d.ou.fromISO(null==l?void 0:l.timestamp).toRelativeCalendar()," on ").concat(d.ou.fromISO(null==l?void 0:l.timestamp).toFormat("yyyy LLL dd"))})]}),(0,n.jsxs)(i.kC,{css:{gap:"$lg","@sm":{flexDirection:"column"}},children:[c?(0,n.jsx)(i.gK,{heading:"Cluster Status",status:c,tooltipContent:"The cluster aggregate status"}):(0,n.jsx)(i.gK,{heading:"Cluster Status",content:"Loading...",tooltipContent:"The cluster aggregate status"}),(0,n.jsx)(i.gK,{heading:"Operators",content:l.operators.length||"0",tooltipContent:"The number of cluster operators"}),(0,n.jsx)(i.gK,{heading:"Validators",content:(null==a?void 0:a.length)||"0",tooltipContent:"The number of cluster validators"})]}),(0,n.jsx)(h.Dq,{operators:l.operators,currentAccount:o,creatorAddress:l.creator.address}),a&&(null==a?void 0:a.length)>0?(0,n.jsx)(v,{validators:a.map((e,s)=>({id:s.toString(),...e}))}):(0,n.jsxs)(i.W2,{css:{gap:"$lg",alignItems:"flex-start"},children:[(0,n.jsx)(i.sQ,{heading:"Distributed Key Generation is incomplete"}),(0,n.jsx)(i.zx,{as:"a",href:"/dv?configHash=".concat(l.config_hash),target:"_blank",children:"Complete DKG"})]}),(null==a?void 0:a.length)>0&&(0,n.jsx)(w,{feeRecipientAddress:l.fee_recipient_address,handleOnDistributeAndWithdrawUserFunds:E,handleOnExit:()=>{},userBalance:A,distributeAndClaimStatus:m,exitClusterStatus:y,splitMetadata:{recipients:null==$?void 0:$.recipients}})]})},C=e=>{let{children:s}=e;return(0,n.jsxs)(i.W2,{css:{borderRadius:0,marginTop:"$7xl"},children:[(0,n.jsx)(i.xv,{variant:"h4",children:"Error \uD83D\uDE25"}),(0,n.jsx)(i.xv,{variant:"body",children:s})]})},_=()=>{var e,s,t,d;let o=(0,l.useRouter)(),{account:c}=(0,r.kR)(),u=o.query.lockHash,{data:x,isLoading:h,error:g}=(0,r.sh)(u?"/lock/".concat(u):null);if(u&&!x&&!h)return(0,n.jsx)(C,{children:(null==g?void 0:null===(e=g.response)||void 0===e?void 0:null===(s=e.data)||void 0===s?void 0:s.message)||"Error: No details information provided, please double check the\n            link you followed or return to the home page."});if(g&&!x)return(0,n.jsx)(C,{children:null==g?void 0:null===(t=g.response)||void 0===t?void 0:null===(d=t.data)||void 0===d?void 0:d.message});if(!x||h)return(0,n.jsxs)(p,{children:[(0,n.jsx)(i.xv,{variant:"subline",children:"Loading cluster data..."}),";"]});let v=null==x?void 0:x.distributed_validators.map((e,s)=>({status:e.isLoadingValidatorStatus?(0,n.jsx)(i.xv,{children:"Loading ..."}):(0,n.jsx)(i.HV,{status:e.status,textVariant:"metricStatusCell"}),address:e.distributed_public_key,withdrawalAddress:(null==x?void 0:x.cluster_definition.validators)?null==x?void 0:x.cluster_definition.validators[s].withdrawal_address:null==x?void 0:x.cluster_definition.withdrawal_address,feeRecipient:(null==x?void 0:x.cluster_definition.validators)?null==x?void 0:x.cluster_definition.validators[s].fee_recipient_address:null==x?void 0:x.cluster_definition.fee_recipient_address}));return(0,n.jsx)(y,{clusterDefinition:x.cluster_definition,validators:v,currentAccount:c,clusterStatus:x.distributed_validators.some(e=>e.isLoadingValidatorStatus)?null:(0,a.Uq)(x)})};var k=_}},function(e){e.O(0,[120,774,888,179],function(){return e(e.s=50068)}),_N_E=e.O()}]);